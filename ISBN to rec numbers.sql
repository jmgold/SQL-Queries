WITH overdrive AS (SELECT
b.best_title, b.best_author
FROM
sierra_view.bib_record_property b
JOIN
sierra_view.subfield s
ON
b.bib_record_id = s.record_id AND s.marc_tag = '020' AND s.tag = 'a'
AND SUBSTRING(s.content FROM '[0-9]+') IN
(
'9781576758922',
'9781515993889',
'9780062797148',
'9781416589501',
'9780310417361',
'9780310417347',
'9780062965103',
'9780062896360',
'9781550925487',
'9781101544457',
'9781476605616',
'9781508238713',
'9781501174209',
'9780525522270',
'9781324005025',
'9781631494437',
'9781641771238',
'9780062688767',
'9781520046891',
'9780823432639',
'9781427295088',
'9781400198009',
'9781628733983',
'9781984846754',
'9780525575498',
'9780525579038',
'9781510742291',
'9781541699038',
'9780062413611',
'9780593165959',
'9781984879509',
'9781504013772',
'9781427288493',
'9780525520931',
'9780399592928',
'9781626562110',
'9781631495687',
'9781705226292',
'9780593134160',
'9780593209660',
'9781478967125',
'9780451493927',
'9781616209605',
'9780307970688',
'9780385535601',
'9781402266751',
'9781549197840',
'9781250167828',
'9780525574842',
'9781797103174',
'9780486110684',
'9780525559115',
'9781101980989',
'9780735225039',
'9780525589310',
'9781510764705',
'9780593346433',
'9781984854674',
'9780593084304',
'9781549125843',
'9781541673984',
'9780062916150',
'9781508265412',
'9781982103156',
'9780525558651',
'9781501175534',
'9781508240105',
'9781620125946',
'9781101986189',
'9781324002659',
'9781427245380',
'9781627790536',
'9781250300300',
'9780804139229',
'9780399563898',
'9781624607578',
'9781549105456',
'9781515928355',
'9780525509134',
'9781524745646',
'9781250227805',
'9780804138253',
'9781524722975',
'9781494596125',
'9780374711498',
'9780525637684',
'9780385529976',
'9781549195990',
'9780316478489',
'9781442367050',
'9781949017267',
'9780062802286',
'9780807094853',
'9781250260994',
'9781250245397',
'9781427298287',
'9780525574767',
'9781984845245',
'9781621575320',
'9781402271441',
'9781982142469',
'9781797106366',
'9780593150498',
'9781427296283',
'9781250168375',
'9780802189387',
'9781615192267',
'9781982556242',
'9780525496090',
'9780399592478',
'9781508254898',
'9781612196961',
'9781621579847',
'9781630061036',
'9781250214164',
'9781250185952',
'9781250191304',
'9781427299765',
'9781476795942',
'9780316421782',
'9781250260352',
'9781250221988',
'9781101972274',
'9781982149994',
'9780679644095',
'9780062974679',
'9781612196336',
'9781504793469',
'9780062880123',
'9780544302372',
'9781982151263',
'9781797113838',
'9781984854643',
'9781250185921',
'9781510750173',
'9781400043934',
'9781524771980',
'9781603763295',
'9781415942352',
'9780307472892',
'9781608468911',
'9780062942708',
'9780062942692',
'9781324006466',
'9781504722162',
'9780804179089',
'9780525500919',
'9780804190121',
'9780698153073',
'9781635571387',
'9781427285355',
'9781250132932',
'9781250754974',
'9781250252852',
'9781619029637',
'9781623710026',
'9780679645078',
'9780399563157',
'9780375414268',
'9780399562860',
'9781797104324',
'9781610395960',
'9780062897923',
'9781250171689',
'9781508281184',
'9781982131760',
'9781797113043',
'9781631491634',
'9780307463142',
'9781508244479',
'9780449009765',
'9780307907035',
'9780525574484',
'9780525632429',
'9781982148058',
'9781797112404',
'9780593171332',
'9780062872753',
'9780062876867',
'9781538730829',
'9781549197444',
'9780062992215',
'9780062992222',
'9780525522034',
'9781250301208',
'9781250217400',
'9780553447095',
'9781524722913',
'9781631494376',
'9781250262073',
'9780399589836',
'9780525659051',
'9780525637882',
'9781524731649',
'9781250238177',
'9781250223906',
'9781250193674',
'9781631496424',
'9781250120625',
'9781588360632',
'9781982141486',
'9781510737464',
'9781523502622',
'9780525522423',
'9781546085386',
'9780525575726',
'9780062852878',
'9781488053627',
'9781984885746',
'9780525560722',
'9780449010082',
'9780393635768',
'9780807019429',
'9780062684943',
'9780062694850',
'9780062698476',
'9781250758309',
'9781250752512',
'9781250262363',
'9781101926673',
'9780374718411',
'9781549131592',
'9781538733813',
'9781427235947',
'9780593212332',
'9781984877505',
'9781541562653',
'9781942186243',
'9781549172113',
'9781549185731',
'9781632207678',
'9780763697518',
'9780399590580',
'9780525494836',
'9780553418828',
'9781622759705',
'9781508239772',
'9781501175572',
'9781453219645',
'9781616207847',
'9781429900324',
'9781478972297',
'9780307719232',
'9781797103167',
'9781476700397',
'9780735219724',
'9780525532446',
'9780698407831',
'9780525509363',
'9780399562372',
'9781455541294',
'9781478915089',
'9781538763667',
'9781549143571',
'9780525522003',
'9780525526742',
'9780525561361'
))
SELECT
DISTINCT id2reckey(b.bib_record_id)
FROM
overdrive o
JOIN
sierra_view.bib_record_property b
ON
CASE
	WHEN LENGTH(o.best_title) < 20 THEN o.best_title = b.best_title
	ELSE SUBSTRING(o.best_title FROM 1 FOR 20) = SUBSTRING(b.best_title FROM 1 FOR 20)
END
AND SUBSTRING(o.best_author FROM 1 FOR 3) = SUBSTRING(b.best_author FROM 1 FOR 3) AND b.material_code = 'a'
JOIN
sierra_view.record_metadata rm
ON
b.bib_record_id = rm.id AND rm.campus_code = ''


