/*
Jeremy Goldstein & Jenn Del Cegno
Minuteman Library Network
Lazy way to generate curated book list for website
www.minlib.net
*/
SELECT *
FROM(
SELECT
--link to Encore
'https://find.minlib.net/iii/encore/record/C__R'||id2reckey(b.bib_record_id)   AS field_booklist_entry_encore_url,
b.best_title as title,
REPLACE(SPLIT_PART(SPLIT_PART(b.best_author,' (',1),', ',2),'.','')||' '||SPLIT_PART(b.best_author,', ',1) as field_booklist_entry_author,
'https://syndetics.com/index.aspx?isbn='||SUBSTRING(MAX(s.content) FROM '[0-9]+')||'/SC.gif&client=minuteman' AS field_booklist_entry_cover
FROM
sierra_view.bib_record_property b
JOIN sierra_view.subfield s
ON
b.bib_record_id = s.record_id AND s.marc_tag = '020' AND s.tag = 'a'
JOIN sierra_view.bib_record_item_record_link bi
ON
b.bib_record_id = bi.bib_record_id
JOIN
sierra_view.bib_view v
ON
b.bib_record_id = v.id AND
v.record_num IN (
'1961686',
'2338385',
'2442516',
'2459368',
'2518707',
'2577354',
'2619118',
'2666146',
'2751209',
'2780060',
'2782790',
'2888087',
'2894519',
'2936104',
'2937067',
'2953070',
'2983267',
'2983269',
'2996763',
'3013880',
'3022669',
'3023826',
'3042015',
'3051904',
'3064352',
'3077187',
'3088864',
'3107862',
'3122714',
'3130577',
'3152727',
'3160601',
'3161966',
'3172365',
'3172992',
'3184304',
'3185190',
'3185195',
'3189615',
'3191260',
'3194245',
'3203684',
'3204739',
'3208715',
'3208716',
'3209355',
'3211048',
'3211432',
'3214664',
'3215314',
'3223898',
'3234752',
'3235548',
'3238195',
'3238198',
'3238202',
'3238205',
'3238466',
'3238467',
'3273835',
'3274371',
'3274378',
'3274396',
'3274398',
'3274399',
'3274545',
'3274549',
'3277270',
'3277274',
'3278140',
'3278216',
'3279222',
'3284862',
'3430532',
'3430533',
'3430534',
'3430535',
'3430536',
'3430537',
'3430928',
'3437336',
'3438680',
'3458910',
'3462142',
'3466870',
'3480736',
'3480745',
'3483311',
'3491354',
'3493510',
'3494234',
'3498511',
'3499228',
'3520289',
'3526741',
'3526742',
'3537084',
'3540938',
'3593497',
'3594261',
'3595271',
'3595468',
'3599610',
'3601824',
'3603618',
'3603619',
'3609326',
'3609330',
'3619950',
'3620696',
'3620697',
'3623194',
'3634779',
'3640394',
'3641035',
'3643553',
'3651379',
'3651606',
'3653745',
'3664990',
'3672193',
'3673545',
'3676213',
'3713687',
'3714320',
'3723113',
'3727392',
'3731462',
'3735270',
'3746153',
'3747090',
'3748612',
'3763475',
'3763476',
'3766786',
'3767668',
'3772035',
'3778356',
'3778357',
'3778359',
'3778360',
'3778361',
'3778362',
'3778364',
'3785125',
'3788463',
'3792340',
'3803351',
'3805871',
'3806168',
'3807770',
'3811312',
'3812404',
'3817503',
'3818889',
'3825371',
'3831692',
'3835360',
'3836869',
'3839205',
'3842241',
'3843874',
'3851938',
'3853881',
'3853883',
'3854536',
'3856973',
'3860490',
'3864406',
'3872055',
'3872353',
'3875480',
'3881562',
'3886505',
'3891025',
'3891127',
'3894056',
'3898169',
'3898677',
'3899447',
'3901727',
'3902740',
'3906574',
'3922970',
'3923167',
'3936626',
'3936627',
'3936675',
'3938171',
'3938173',
'3938181',
'3938224',
'3938775',
'3939993',
'3942999',
'3943051',
'3943994',
'3944190',
'3945115',
'3946466',
'3950247',
'3960850',
'3961284',
'3970832',
'3970875',
'3972369',
'3983377',
'3984061',
'3986977',
'3992995',
'3993477',
'3996532',
'3997103',
'3997144',
'4002093',
'4002827',
'4007392',
'4007772',
'4011727',
'4015424'
)
WHERE b.material_code ='a'
GROUP BY 1,2,3 ) a
ORDER BY RANDOM()
LIMIT 50;