/*
Jeremy Goldstein & Jenn Del Cegno
Minuteman Library Network
Lazy way to generate curated book list for website
www.minlib.net
*/
SELECT *
FROM(
SELECT
--link to Encore
'https://find.minlib.net/iii/encore/record/C__R'||id2reckey(b.bib_record_id)   AS field_booklist_entry_encore_url,
b.best_title as title,
REPLACE(SPLIT_PART(SPLIT_PART(b.best_author,' (',1),', ',2),'.','')||' '||SPLIT_PART(b.best_author,', ',1) as field_booklist_entry_author,
'https://syndetics.com/index.aspx?isbn='||SUBSTRING(MAX(s.content) FROM '[0-9]+')||'/SC.gif&client=minuteman' AS field_booklist_entry_cover
FROM
sierra_view.bib_record_property b
JOIN sierra_view.subfield s
ON
b.bib_record_id = s.record_id AND s.marc_tag = '020' AND s.tag = 'a'
JOIN sierra_view.bib_record_item_record_link bi
ON
b.bib_record_id = bi.bib_record_id
JOIN
sierra_view.bib_view v
ON
b.bib_record_id = v.id AND
v.record_num IN (
'3462999',
'3024445',
'3212742',
'1735388',
'3891604',
'2939670',
'3463024',
'3838345',
'3568573',
'3894602',
'2248922',
'1873643',
'3892168',
'3176129',
'3986831',
'3232932',
'3949952',
'3893180',
'3169517',
'3679319',
'3629354',
'2163889',
'4003315',
'2914798',
'3759705',
'3768100',
'3540754',
'2953669',
'3994515',
'3874706',
'3228203',
'4008072',
'3844618',
'4012102',
'3916938',
'3723908',
'3194871',
'3849780',
'3646974',
'3762995',
'1781102',
'2731017',
'3853125',
'1355543',
'3680712',
'3106448',
'2435016',
'3782590',
'3237806',
'3653799',
'3936792',
'3918656',
'3269199',
'2402248',
'3848124',
'3767537',
'3069844',
'2473188',
'1714528',
'1813841',
'3619830',
'3036147',
'3161542',
'3978022',
'3171153',
'1200813',
'3222657',
'3197742',
'1200812',
'3192407',
'2121191',
'1911224',
'3887183',
'3777605',
'3183017',
'3869561',
'3948867',
'3849619',
'3640414',
'3987441',
'3637276',
'3715047',
'4003461',
'3912876',
'3756702',
'115981',
'3821994',
'1443443',
'3085842',
'3475284',
'3038713',
'3838653',
'3639073',
'3181112',
'3982282',
'3940732',
'3812391',
'3817520',
'2446192',
'3976892',
'3819884',
'2068925',
'3967265',
'3880219',
'3477735',
'3712932',
'2513908',
'3176375',
'3994269',
'2861433',
'3875803',
'3101208',
'3157642',
'3728706',
'2881159',
'3612223',
'3637038',
'3872811',
'2765733',
'1592529',
'4003460',
'1408913',
'3654572',
'2306325',
'1675906',
'3911759',
'2248230',
'2055912',
'1565946',
'3089752',
'3979450',
'3916917',
'3752152',
'3678026',
'3110151',
'3526110',
'3227094',
'3859719',
'3102333',
'3960084',
'3239656',
'3508020',
'3970810',
'3172840',
'3739730',
'3539125',
'3872899',
'3228379',
'3923403',
'3775375',
'3639377',
'3105366'
)
WHERE b.material_code ='a'
GROUP BY 1,2,3 ) a
ORDER BY RANDOM()
LIMIT 50;